<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>My Bookings - GymNest</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Font Awesome -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
  <!-- Custom Styles -->
  <style>
    :root {
      --primary: #E63946;
      --primary-600: #D32F2F;
      --primary-rgb: 230, 57, 70;
      --secondary: #457B9D;
      --secondary-600: #3D6B8A;
      --secondary-rgb: 69, 123, 157;
      --accent: #FCA311;
      --accent-rgb: 252, 163, 17;
      --dark: #1D3557;
      --light: #F1FAEE;
      --ink: #121212;
      --muted: #6c757d;
      --card-bg: #ffffff;
      --bg: #f8f9fa;
      --section-pad: 5rem 0;
      --border-radius: 12px;
      --shadow-1: 0 10px 25px rgba(0,0,0,.08);
      --shadow-2: 0 16px 40px rgba(0,0,0,.12);
    }

    body {
      color: var(--ink);
      background: var(--bg);
      font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
    }

    .section { padding: var(--section-pad); }
    .page-header {
      padding: 5rem 0 3rem;
      background: linear-gradient(90deg, var(--dark) 0%, var(--secondary) 100%);
      color: #fff;
      text-align: center;
      position: relative;
    }
    .page-header::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: url('https://images.unsplash.com/photo-1534438327276-14e5300c3a48?auto=format&fit=crop&w=1920&q=80') center/cover;
      opacity: 0.1;
      z-index: -1;
    }
    .page-header h1 { font-weight: 800; margin-bottom: 1rem; }
    .page-subtitle { color: #cfd3da; font-size: 1.25rem; max-width: 600px; margin: 0 auto; }

    .navbar {
      background: rgba(255, 255, 255, 0.95) !important;
      backdrop-filter: blur(10px);
      box-shadow: 0 2px 15px rgba(0,0,0,0.1);
    }
    .navbar-brand { font-weight: 800; }
    .navbar-brand i { color: var(--primary); }
    .navbar-nav .nav-link {
      color: var(--dark);
      font-weight: 500;
      transition: color 0.15s ease;
    }
    .navbar-nav .nav-link:hover, .navbar-nav .nav-link.active {
      color: var(--primary);
    }

    .table { background: #fff; }
    .table thead th {
      background-color: var(--primary-600) !important;
      color: #fff;
      border-color: var(--primary-600) !important;
    }
    .table-bordered {
      border-color: rgba(31,43,34,.12) !important;
    }
    .table-striped tbody tr:nth-of-type(odd) {
      background-color: rgba(69,123,157,.03);
    }
    .table-responsive { overflow-x: auto; }
    @media (max-width: 576px) {
      .table-responsive { display: block; white-space: nowrap; }
    }

    .btn-outline-danger, .btn-outline-secondary {
      border-radius: 8px;
      font-weight: 600;
    }

    .footer {
      background: var(--dark);
      color: #cfd3da;
      padding: 4rem 0 2rem;
    }
    .footer a { color: #cfd3da; text-decoration: none; }
    .footer a:hover { color: #fff; }
    .fade-in {
      animation: fadeIn 0.6s ease forwards;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    @media (max-width: 768px) {
      .section { padding: 3rem 0; }
    }
  </style>
</head>
<body>
<!-- Navbar -->
<nav class="navbar navbar-expand-lg sticky-top shadow-sm">
  <div class="container">
    <a class="navbar-brand" href="index.html"><i class="fa-solid fa-dumbbell me-2"></i>GymNest</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#nav" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="nav">
      <ul class="navbar-nav ms-auto">
        <li class="nav-item"><a class="nav-link" href="index.html">Home</a></li>
        <li class="nav-item"><a class="nav-link" href="booking.html">Book</a></li>
        <li class="nav-item"><a class="nav-link active" href="user-booking.html">My Bookings</a></li>
        <li class="nav-item dropdown d-none d-lg-inline-flex ms-lg-3" id="userDropdown"></li>
      </ul>
    </div>
  </div>
</nav>

<!-- Page Header -->
<header class="page-header">
  <div class="container">
    <h1>My Bookings</h1>
    <p class="page-subtitle">Manage your upcoming gym sessions.</p>
  </div>
</header>

<!-- Bookings Section -->
<section class="section">
  <div class="container">
    <div class="card shadow-lg p-4">
      <h2 class="mb-4 text-center">Your Booking Details</h2>
      <div class="table-responsive">
        <table class="table table-striped table-bordered align-middle">
          <thead>
          <tr>
            <th>#</th>
            <th>Package</th>
            <th>Class</th>
            <th>Coach</th>
            <th>Location</th>
            <th>Booking Date</th>
            <th>End Date</th>
            <th>Sessions</th>
            <th>Total Price</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
          </thead>
          <tbody id="userBookingTableBody">
          <tr>
            <td colspan="11" class="text-center">Loading your bookings...</td>
          </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</section>

<!-- Footer -->
<footer class="footer mt-5 pt-5 pb-4">
  <div class="container">
    <div class="row g-4">
      <div class="col-md-4">
        <div class="brand mb-2"><i class="fa-solid fa-dumbbell me-2 text-warning"></i>GymNest</div>
        <p>Stronger every day — with expert coaching and a community that has your back.</p>
      </div>
      <div class="col-md-4">
        <h6 class="text-white">Quick Links</h6>
        <ul class="list-unstyled">
          <li><a href="index.html">Home</a></li>
          <li><a href="index.html#about">About</a></li>
          <li><a href="index.html#classes">Classes</a></li>
          <li><a href="index.html#coaches">Coaches</a></li>
          <li><a href="index.html#locations">Locations</a></li>
          <li><a href="index.html#contact">Contact</a></li>
        </ul>
      </div>
      <div class="col-md-4">
        <h6 class="text-white">Contact</h6>
        <p><i class="fa-solid fa-location-dot me-2"></i> 45 King Street, Colombo</p>
        <p><i class="fa-solid fa-phone me-2"></i> +94 77 123 4567</p>
        <p><i class="fa-solid fa-envelope me-2"></i> hello@gymnest.fit</p>
      </div>
    </div>
    <div class="copyright mt-4 pt-3 text-center">
      <span>© <span class="year"></span> GymNest</span>
    </div>
  </div>
</footer>

<!-- Scripts -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
  // Initialize footer year
  document.querySelectorAll('.year').forEach(el => el.textContent = new Date().getFullYear());

  // Get Data from Local Storage with Expiration Check
  function getFromLocalStorage(key) {
    const data = localStorage.getItem(key);
    if (!data) return null;

    try {
      // Check if it's a simple string value (not JSON)
      if (!data.startsWith('{')) {
        return data;
      }

      const parsedData = JSON.parse(data);
      const now = new Date().getTime();

      if (now > parsedData.expiry) {
        localStorage.removeItem(key);
        return null;
      }
      return parsedData.value;
    } catch (e) {
      // If parsing fails, return the raw value
      return data;
    }
  }

  // User Dropdown Functionality
  const userDropdown = document.getElementById("userDropdown");
  function updateDropdownContent(isLoggedIn, userName) {
    userDropdown.innerHTML = "";
    if (isLoggedIn) {
      userDropdown.classList.remove("d-none");
      const userLink = document.createElement("a");
      userLink.className = "nav-link dropdown-toggle";
      userLink.href = "#";
      userLink.id = "userDropdownLink";
      userLink.setAttribute("data-bs-toggle", "dropdown");
      userLink.setAttribute("aria-expanded", "false");
      userLink.textContent = `Hi, ${userName}`;
      userDropdown.appendChild(userLink);

      const dropdownMenu = document.createElement("ul");
      dropdownMenu.className = "dropdown-menu";
      dropdownMenu.setAttribute("aria-labelledby", "userDropdownLink");
      dropdownMenu.innerHTML = `
        <li><a class="dropdown-item" href="user-profile.html">User Profile</a></li>
        <li><a class="dropdown-item" href="user-booking.html">Bookings</a></li>
        <li><a class="dropdown-item text-danger" id="logoutBtn">Log out</a></li>
      `;
      userDropdown.appendChild(dropdownMenu);

      document.getElementById("logoutBtn").addEventListener("click", function (event) {
        event.preventDefault();
        localStorage.removeItem("name");
        localStorage.removeItem("token");
        localStorage.removeItem("email");
        localStorage.removeItem("role");
        updateDropdownContent(false, "");
        window.location.href = "signin.html";
      });
    } else {
      userDropdown.classList.remove("d-none");
      const signInLink = document.createElement("a");
      signInLink.className = "nav-link";
      signInLink.href = "signin.html";
      signInLink.textContent = "Sign in/up";
      userDropdown.appendChild(signInLink);
    }
  }

  // Check User Login
  function checkUserLogin() {
    const name = localStorage.getItem("name") || getFromLocalStorage("name");
    const token = localStorage.getItem("token") || getFromLocalStorage("token");
    const email = localStorage.getItem("email") || getFromLocalStorage("email");

    if (name && token && email) {
      updateDropdownContent(true, name);
      loadUserBookings(email, token);
    } else {
      updateDropdownContent(false, "");
      window.location.href = "signin.html";
    }
  }

  // Load User Bookings
  function loadUserBookings(userEmail, authToken) {
    const BASE_URL = "http://localhost:8080/api/v1/bookings/getBookings";

    console.log("Loading bookings for:", userEmail);
    console.log("Using token:", authToken ? "Token present" : "No token");

    $.ajax({
      url: `${BASE_URL}/${userEmail}`,
      method: "GET",
      headers: {
        "Authorization": `Bearer ${authToken}`
      },
      success: function (response) {
        console.log("Bookings API response:", response);

        // Handle different response structures
        let bookings = [];
        if (Array.isArray(response)) {
          bookings = response;
        } else if (response && response.data && Array.isArray(response.data)) {
          bookings = response.data;
        } else if (response && Array.isArray(response)) {
          bookings = response;
        }

        $("#userBookingTableBody").empty();

        if (bookings.length === 0) {
          $("#userBookingTableBody").html(`
            <tr><td colspan="11" class="text-center">No bookings found</td></tr>
          `);
          return;
        }

        bookings.forEach((booking, index) => {
          // Determine status and styling
          let statusClass = "text-bg-secondary";
          let statusText = "COMPLETED";

          if (booking.status === "ACTIVE") {
            statusClass = "text-bg-success";
            statusText = "ACTIVE";
          } else if (booking.status === "CANCELLED") {
            statusClass = "text-bg-danger";
            statusText = "CANCELLED";
          }

          $("#userBookingTableBody").append(`
            <tr>
              <td>${index + 1}</td>
              <td>${booking.packageName || (booking.gymPackage && booking.gymPackage.name) || 'N/A'}</td>
              <td>${booking.className || (booking.gymClass && booking.gymClass.name) || 'N/A'}</td>
              <td>${booking.coachEmail || (booking.coach && booking.coach.email) || (booking.coach && booking.coach.fullName) || 'N/A'}</td>
              <td>${booking.locationName || (booking.location && booking.location.name) || 'N/A'}</td>
              <td>${booking.bookingDate || 'N/A'}</td>
              <td>${booking.endDate || 'N/A'}</td>
              <td>${booking.numberOfSessions || 'N/A'}</td>
              <td>LKR ${(booking.totalPrice || 0).toFixed(2)}</td>
              <td><span class="badge ${statusClass}">${statusText}</span></td>
              <td>
                ${booking.status === "ACTIVE" ?
                  `<button class="btn btn-sm btn-outline-danger cancel-btn" data-id="${booking.id}">Cancel</button>` :
                  `<button class="btn btn-sm btn-outline-secondary" disabled>Completed</button>`}
              </td>
            </tr>
          `);
        });

        // Add event listeners to cancel buttons
        $(".cancel-btn").on("click", function() {
          const bookingId = $(this).data("id");
          if (confirm("Are you sure you want to cancel this booking?")) {
            cancelBooking(bookingId);
          }
        });
      },
      error: function(xhr, status, error) {
        console.error("Error fetching user bookings:", xhr.status, xhr.responseText);

        let errorMessage = "Failed to load bookings. Please try again later.";
        if (xhr.status === 403) {
          errorMessage = "Access denied. Please log in again.";
          // Redirect to login if token is invalid
          setTimeout(() => {
            window.location.href = "signin.html";
          }, 2000);
        } else if (xhr.status === 404) {
          errorMessage = "Bookings not found. The API endpoint may be incorrect.";
        }

        $("#userBookingTableBody").html(`
          <tr><td colspan="11" class="text-center text-danger">${errorMessage}</td></tr>
        `);
      }
    });
  }

  // Cancel Booking
  function cancelBooking(bookingId) {
    const BASE_URL = "http://localhost:8080/api/v1/bookings";
    const token = localStorage.getItem("token") || getFromLocalStorage("token");

    $.ajax({
      url: `${BASE_URL}/${bookingId}`,
      method: "DELETE",
      headers: {
        "Authorization": `Bearer ${token}`
      },
      success: function(response) {
        alert("Booking cancelled successfully!");
        // Reload bookings
        const email = localStorage.getItem("email") || getFromLocalStorage("email");
        loadUserBookings(email, token);
      },
      error: function(xhr) {
        console.error("Error cancelling booking:", xhr.responseText);
        if (xhr.status === 403) {
          alert("Session expired. Please log in again.");
          window.location.href = "signin.html";
        } else {
          alert("Failed to cancel booking. Please try again.");
        }
      }
    });
  }

  // Initialize
  $(document).ready(function() {
    checkUserLogin();
  });
</script>
</body>
</html>

























<!--<!DOCTYPE html>-->
<!--<html lang="en">-->
<!--<head>-->
<!--  <meta charset="UTF-8">-->
<!--  <meta name="viewport" content="width=device-width, initial-scale=1.0">-->
<!--  <title>My Bookings - GymNest</title>-->
<!--  &lt;!&ndash; Bootstrap CSS &ndash;&gt;-->
<!--  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">-->
<!--  &lt;!&ndash; Font Awesome &ndash;&gt;-->
<!--  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">-->
<!--  &lt;!&ndash; Custom Styles &ndash;&gt;-->
<!--  <style>-->
<!--    :root {-->
<!--      &#45;&#45;primary: #E63946;-->
<!--      &#45;&#45;primary-600: #D32F2F;-->
<!--      &#45;&#45;primary-rgb: 230, 57, 70;-->
<!--      &#45;&#45;secondary: #457B9D;-->
<!--      &#45;&#45;secondary-600: #3D6B8A;-->
<!--      &#45;&#45;secondary-rgb: 69, 123, 157;-->
<!--      &#45;&#45;accent: #FCA311;-->
<!--      &#45;&#45;accent-rgb: 252, 163, 17;-->
<!--      &#45;&#45;dark: #1D3557;-->
<!--      &#45;&#45;light: #F1FAEE;-->
<!--      &#45;&#45;ink: #121212;-->
<!--      &#45;&#45;muted: #6c757d;-->
<!--      &#45;&#45;card-bg: #ffffff;-->
<!--      &#45;&#45;bg: #f8f9fa;-->
<!--      &#45;&#45;section-pad: 5rem 0;-->
<!--      &#45;&#45;border-radius: 12px;-->
<!--      &#45;&#45;shadow-1: 0 10px 25px rgba(0,0,0,.08);-->
<!--      &#45;&#45;shadow-2: 0 16px 40px rgba(0,0,0,.12);-->
<!--    }-->

<!--    body {-->
<!--      color: var(&#45;&#45;ink);-->
<!--      background: var(&#45;&#45;bg);-->
<!--      font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;-->
<!--    }-->

<!--    .section { padding: var(&#45;&#45;section-pad); }-->
<!--    .page-header {-->
<!--      padding: 5rem 0 3rem;-->
<!--      background: linear-gradient(90deg, var(&#45;&#45;dark) 0%, var(&#45;&#45;secondary) 100%);-->
<!--      color: #fff;-->
<!--      text-align: center;-->
<!--      position: relative;-->
<!--    }-->
<!--    .page-header::before {-->
<!--      content: '';-->
<!--      position: absolute;-->
<!--      top: 0;-->
<!--      left: 0;-->
<!--      right: 0;-->
<!--      bottom: 0;-->
<!--      background: url('https://images.unsplash.com/photo-1534438327276-14e5300c3a48?auto=format&fit=crop&w=1920&q=80') center/cover;-->
<!--      opacity: 0.1;-->
<!--      z-index: -1;-->
<!--    }-->
<!--    .page-header h1 { font-weight: 800; margin-bottom: 1rem; }-->
<!--    .page-subtitle { color: #cfd3da; font-size: 1.25rem; max-width: 600px; margin: 0 auto; }-->

<!--    .navbar {-->
<!--      background: rgba(255, 255, 255, 0.95) !important;-->
<!--      backdrop-filter: blur(10px);-->
<!--      box-shadow: 0 2px 15px rgba(0,0,0,0.1);-->
<!--    }-->
<!--    .navbar-brand { font-weight: 800; }-->
<!--    .navbar-brand i { color: var(&#45;&#45;primary); }-->
<!--    .navbar-nav .nav-link {-->
<!--      color: var(&#45;&#45;dark);-->
<!--      font-weight: 500;-->
<!--      transition: color 0.15s ease;-->
<!--    }-->
<!--    .navbar-nav .nav-link:hover, .navbar-nav .nav-link.active {-->
<!--      color: var(&#45;&#45;primary);-->
<!--    }-->

<!--    .table { background: #fff; }-->
<!--    .table thead th {-->
<!--      background-color: var(&#45;&#45;primary-600) !important;-->
<!--      color: #fff;-->
<!--      border-color: var(&#45;&#45;primary-600) !important;-->
<!--    }-->
<!--    .table-bordered {-->
<!--      border-color: rgba(31,43,34,.12) !important;-->
<!--    }-->
<!--    .table-striped tbody tr:nth-of-type(odd) {-->
<!--      background-color: rgba(69,123,157,.03);-->
<!--    }-->
<!--    .table-responsive { overflow-x: auto; }-->
<!--    @media (max-width: 576px) {-->
<!--      .table-responsive { display: block; white-space: nowrap; }-->
<!--    }-->

<!--    .btn-outline-danger, .btn-outline-secondary {-->
<!--      border-radius: 8px;-->
<!--      font-weight: 600;-->
<!--    }-->

<!--    .footer {-->
<!--      background: var(&#45;&#45;dark);-->
<!--      color: #cfd3da;-->
<!--      padding: 4rem 0 2rem;-->
<!--    }-->
<!--    .footer a { color: #cfd3da; text-decoration: none; }-->
<!--    .footer a:hover { color: #fff; }-->
<!--    .fade-in {-->
<!--      animation: fadeIn 0.6s ease forwards;-->
<!--    }-->
<!--    @keyframes fadeIn {-->
<!--      from { opacity: 0; transform: translateY(20px); }-->
<!--      to { opacity: 1; transform: translateY(0); }-->
<!--    }-->
<!--    @media (max-width: 768px) {-->
<!--      .section { padding: 3rem 0; }-->
<!--    }-->
<!--  </style>-->
<!--</head>-->
<!--<body>-->
<!--&lt;!&ndash; Navbar &ndash;&gt;-->
<!--<nav class="navbar navbar-expand-lg sticky-top shadow-sm">-->
<!--  <div class="container">-->
<!--    <a class="navbar-brand" href="index.html"><i class="fa-solid fa-dumbbell me-2"></i>GymNest</a>-->
<!--    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#nav" aria-label="Toggle navigation">-->
<!--      <span class="navbar-toggler-icon"></span>-->
<!--    </button>-->
<!--    <div class="collapse navbar-collapse" id="nav">-->
<!--      <ul class="navbar-nav ms-auto">-->
<!--        <li class="nav-item"><a class="nav-link" href="index.html">Home</a></li>-->
<!--        <li class="nav-item"><a class="nav-link" href="booking.html">Book</a></li>-->
<!--        <li class="nav-item"><a class="nav-link active" href="user-booking.html">My Bookings</a></li>-->
<!--        <li class="nav-item dropdown d-none d-lg-inline-flex ms-lg-3" id="userDropdown"></li>-->
<!--      </ul>-->
<!--    </div>-->
<!--  </div>-->
<!--</nav>-->

<!--&lt;!&ndash; Page Header &ndash;&gt;-->
<!--<header class="page-header">-->
<!--  <div class="container">-->
<!--    <h1>My Bookings</h1>-->
<!--    <p class="page-subtitle">Manage your upcoming gym sessions.</p>-->
<!--  </div>-->
<!--</header>-->

<!--&lt;!&ndash; Bookings Section &ndash;&gt;-->
<!--<section class="section">-->
<!--  <div class="container">-->
<!--    <div class="card shadow-lg p-4">-->
<!--      <h2 class="mb-4 text-center">Your Booking Details</h2>-->
<!--      <div class="table-responsive">-->
<!--        <table class="table table-striped table-bordered align-middle">-->
<!--          <thead>-->
<!--          <tr>-->
<!--            <th>#</th>-->
<!--            <th>Package</th>-->
<!--            <th>Class</th>-->
<!--            <th>Coach</th>-->
<!--            <th>Location</th>-->
<!--            <th>Booking Date</th>-->
<!--            <th>End Date</th>-->
<!--            <th>Sessions</th>-->
<!--            <th>Total Price</th>-->
<!--            <th>Status</th>-->
<!--            <th>Actions</th>-->
<!--          </tr>-->
<!--          </thead>-->
<!--          <tbody id="userBookingTableBody"></tbody>-->
<!--        </table>-->
<!--      </div>-->
<!--    </div>-->
<!--  </div>-->
<!--</section>-->

<!--&lt;!&ndash; Footer &ndash;&gt;-->
<!--<footer class="footer mt-5 pt-5 pb-4">-->
<!--  <div class="container">-->
<!--    <div class="row g-4">-->
<!--      <div class="col-md-4">-->
<!--        <div class="brand mb-2"><i class="fa-solid fa-dumbbell me-2 text-warning"></i>GymNest</div>-->
<!--        <p>Stronger every day — with expert coaching and a community that has your back.</p>-->
<!--      </div>-->
<!--      <div class="col-md-4">-->
<!--        <h6 class="text-white">Quick Links</h6>-->
<!--        <ul class="list-unstyled">-->
<!--          <li><a href="index.html">Home</a></li>-->
<!--          <li><a href="index.html#about">About</a></li>-->
<!--          <li><a href="index.html#classes">Classes</a></li>-->
<!--          <li><a href="index.html#coaches">Coaches</a></li>-->
<!--          <li><a href="index.html#locations">Locations</a></li>-->
<!--          <li><a href="index.html#contact">Contact</a></li>-->
<!--        </ul>-->
<!--      </div>-->
<!--      <div class="col-md-4">-->
<!--        <h6 class="text-white">Contact</h6>-->
<!--        <p><i class="fa-solid fa-location-dot me-2"></i> 45 King Street, Colombo</p>-->
<!--        <p><i class="fa-solid fa-phone me-2"></i> +94 77 123 4567</p>-->
<!--        <p><i class="fa-solid fa-envelope me-2"></i> hello@gymnest.fit</p>-->
<!--      </div>-->
<!--    </div>-->
<!--    <div class="copyright mt-4 pt-3 text-center">-->
<!--      <span>© <span class="year"></span> GymNest</span>-->
<!--    </div>-->
<!--  </div>-->
<!--</footer>-->

<!--&lt;!&ndash; Scripts &ndash;&gt;-->
<!--<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>-->
<!--<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>-->
<!--<script>-->
<!--  // Initialize footer year-->
<!--  document.querySelectorAll('.year').forEach(el => el.textContent = new Date().getFullYear());-->

<!--  // User Dropdown Functionality-->
<!--  const userDropdown = document.getElementById("userDropdown");-->
<!--  function updateDropdownContent(isLoggedIn, userName) {-->
<!--    userDropdown.innerHTML = "";-->
<!--    if (isLoggedIn) {-->
<!--      userDropdown.classList.remove("d-none");-->
<!--      const userLink = document.createElement("a");-->
<!--      userLink.className = "nav-link dropdown-toggle";-->
<!--      userLink.href = "#";-->
<!--      userLink.id = "userDropdownLink";-->
<!--      userLink.setAttribute("data-bs-toggle", "dropdown");-->
<!--      userLink.setAttribute("aria-expanded", "false");-->
<!--      userLink.textContent = `Hi, ${userName}`;-->
<!--      userDropdown.appendChild(userLink);-->

<!--      const dropdownMenu = document.createElement("ul");-->
<!--      dropdownMenu.className = "dropdown-menu";-->
<!--      dropdownMenu.setAttribute("aria-labelledby", "userDropdownLink");-->
<!--      dropdownMenu.innerHTML = `-->
<!--                <li><a class="dropdown-item" href="user-profile.html">User Profile</a></li>-->
<!--                <li><a class="dropdown-item" href="user-booking.html">Bookings</a></li>-->
<!--                <li><a class="dropdown-item text-danger" id="logoutBtn">Log out</a></li>-->
<!--            `;-->
<!--      userDropdown.appendChild(dropdownMenu);-->

<!--      document.getElementById("logoutBtn").addEventListener("click", function (event) {-->
<!--        event.preventDefault();-->
<!--        localStorage.removeItem("name");-->
<!--        localStorage.removeItem("token");-->
<!--        localStorage.removeItem("email");-->
<!--        localStorage.removeItem("role");-->
<!--        updateDropdownContent(false, "");-->
<!--        window.location.href = "signin.html";-->
<!--      });-->
<!--    } else {-->
<!--      userDropdown.classList.remove("d-none");-->
<!--      const signInLink = document.createElement("a");-->
<!--      signInLink.className = "nav-link";-->
<!--      signInLink.href = "signin.html";-->
<!--      signInLink.textContent = "Sign in/up";-->
<!--      userDropdown.appendChild(signInLink);-->
<!--    }-->
<!--  }-->

<!--  // Check User Login-->
<!--  function checkUserLogin() {-->
<!--    const name = localStorage.getItem("name");-->
<!--    const token = localStorage.getItem("token");-->
<!--    const email = localStorage.getItem("email");-->
<!--    if (name && token && email) {-->
<!--      updateDropdownContent(true, name);-->
<!--      loadUserBookings(email);-->
<!--    } else {-->
<!--      updateDropdownContent(false, "");-->
<!--      window.location.href = "signin.html";-->
<!--    }-->
<!--  }-->

<!--  // Load User Bookings-->
<!--  function loadUserBookings(userEmail) {-->
<!--    const BASE_URL = "http://localhost:8080/api/v1/bookings";-->
<!--    // Mock data for 3 bookings (replace with real API call if available)-->
<!--    const mockResponse = {-->
<!--      code: 200,-->
<!--      data: [-->
<!--        {-->
<!--          id: 1,-->
<!--          userEmail: userEmail,-->
<!--          packageName: "Basic Package",-->
<!--          className: "Yoga",-->
<!--          coachEmail: "coach1@example.com",-->
<!--          locationName: "Colombo Gym",-->
<!--          bookingDate: "2025-09-16",-->
<!--          endDate: "2025-09-20",-->
<!--          numberOfSessions: 5,-->
<!--          totalPrice: 5000,-->
<!--          status: "ACTIVE"-->
<!--        },-->
<!--        {-->
<!--          id: 2,-->
<!--          userEmail: userEmail,-->
<!--          packageName: "Premium Package",-->
<!--          className: "Zumba",-->
<!--          coachEmail: "coach2@example.com",-->
<!--          locationName: "Kandy Fitness Center",-->
<!--          bookingDate: "2025-09-17",-->
<!--          endDate: "2025-09-21",-->
<!--          numberOfSessions: 3,-->
<!--          totalPrice: 7500,-->
<!--          status: "ACTIVE"-->
<!--        },-->
<!--        {-->
<!--          id: 3,-->
<!--          userEmail: userEmail,-->
<!--          packageName: "Advanced Package",-->
<!--          className: "Weightlifting",-->
<!--          coachEmail: "coach3@example.com",-->
<!--          locationName: "Galle Sports Club",-->
<!--          bookingDate: "2025-09-18",-->
<!--          endDate: "2025-09-22",-->
<!--          numberOfSessions: 4,-->
<!--          totalPrice: 6000,-->
<!--          status: "ACTIVE"-->
<!--        }-->
<!--      ]-->
<!--    };-->

<!--    if (mockResponse.code === 200 && mockResponse.data && Array.isArray(mockResponse.data)) {-->
<!--      let rows = "";-->
<!--      mockResponse.data.forEach((booking, index) => {-->
<!--        rows += `-->
<!--          <tr>-->
<!--            <td>${index + 1}</td>-->
<!--            <td>${booking.packageName}</td>-->
<!--            <td>${booking.className}</td>-->
<!--            <td>${booking.coachEmail}</td>-->
<!--            <td>${booking.locationName}</td>-->
<!--            <td>${booking.bookingDate}</td>-->
<!--            <td>${booking.endDate}</td>-->
<!--            <td>${booking.numberOfSessions}</td>-->
<!--            <td>LKR ${booking.totalPrice.toFixed(2)}</td>-->
<!--            <td><span class="badge ${booking.status === "ACTIVE" ? "text-bg-success" : "text-bg-danger"}">${booking.status}</span></td>-->
<!--            <td>-->
<!--              ${booking.status === "ACTIVE" ?-->
<!--                `<button class="btn btn-sm btn-outline-danger cancel-btn" data-id="${booking.id}">Cancel</button>` :-->
<!--                `<button class="btn btn-sm btn-outline-secondary edit-btn" data-id="${booking.id}">Edit</button>`}-->
<!--            </td>-->
<!--          </tr>-->
<!--        `;-->
<!--      });-->
<!--      $("#userBookingTableBody").html(rows);-->

<!--      // Handle Cancel Button-->
<!--      $(".cancel-btn").on("click", function () {-->
<!--        const bookingId = $(this).data("id");-->
<!--        if (confirm("Are you sure you want to cancel this booking?")) {-->
<!--          cancelBooking(bookingId);-->
<!--        }-->
<!--      });-->

<!--      // Handle Edit Button-->
<!--      $(".edit-btn").on("click", function () {-->
<!--        const bookingId = $(this).data("id");-->
<!--        localStorage.setItem("editBookingId", bookingId);-->
<!--        window.location.href = "booking.html";-->
<!--      });-->
<!--    } else {-->
<!--      $("#userBookingTableBody").html(`-->
<!--        <tr><td colspan="11" class="text-center">No bookings found</td></tr>-->
<!--      `);-->
<!--    }-->

<!--    // Uncomment the following block to use real API call instead of mock data-->
<!--    /*-->
<!--    $.ajax({-->
<!--      url: `${BASE_URL}/getByUser/${userEmail}`,-->
<!--      method: "GET",-->
<!--      headers: {-->
<!--        "Authorization": `Bearer ${localStorage.getItem("token")}`-->
<!--      },-->
<!--      success: function (response) {-->
<!--        if (response.code === 200 && response.data && Array.isArray(response.data)) {-->
<!--          let rows = "";-->
<!--          response.data.forEach((booking, index) => {-->
<!--            rows += `-->
<!--              <tr>-->
<!--                <td>${index + 1}</td>-->
<!--                <td>${booking.packageName}</td>-->
<!--                <td>${booking.className}</td>-->
<!--                <td>${booking.coachEmail}</td>-->
<!--                <td>${booking.locationName}</td>-->
<!--                <td>${booking.bookingDate}</td>-->
<!--                <td>${booking.endDate}</td>-->
<!--                <td>${booking.numberOfSessions}</td>-->
<!--                <td>LKR ${booking.totalPrice.toFixed(2)}</td>-->
<!--                <td><span class="badge ${booking.status === "ACTIVE" ? "text-bg-success" : "text-bg-danger"}">${booking.status}</span></td>-->
<!--                <td>-->
<!--                  ${booking.status === "ACTIVE" ?-->
<!--                    `<button class="btn btn-sm btn-outline-danger cancel-btn" data-id="${booking.id}">Cancel</button>` :-->
<!--                    `<button class="btn btn-sm btn-outline-secondary edit-btn" data-id="${booking.id}">Edit</button>`}-->
<!--                </td>-->
<!--              </tr>-->
<!--            `;-->
<!--          });-->
<!--          $("#userBookingTableBody").html(rows);-->

<!--          // Handle Cancel Button-->
<!--          $(".cancel-btn").on("click", function () {-->
<!--            const bookingId = $(this).data("id");-->
<!--            if (confirm("Are you sure you want to cancel this booking?")) {-->
<!--              cancelBooking(bookingId);-->
<!--            }-->
<!--          });-->

<!--          // Handle Edit Button-->
<!--          $(".edit-btn").on("click", function () {-->
<!--            const bookingId = $(this).data("id");-->
<!--            localStorage.setItem("editBookingId", bookingId);-->
<!--            window.location.href = "booking.html";-->
<!--          });-->
<!--        } else {-->
<!--          $("#userBookingTableBody").html(`-->
<!--            <tr><td colspan="11" class="text-center">No bookings found</td></tr>-->
<!--          `);-->
<!--        }-->
<!--      },-->
<!--      error: function (xhr) {-->
<!--        console.error("Error loading bookings:", xhr);-->
<!--        $("#userBookingTableBody").html(`-->
<!--          <tr><td colspan="11" class="text-center text-danger">Failed to load bookings</td></tr>-->
<!--        `);-->
<!--      }-->
<!--    });-->
<!--    */-->
<!--  }-->

<!--  // Cancel Booking-->
<!--  function cancelBooking(bookingId) {-->
<!--    const BASE_URL = "http://localhost:8080/api/v1/bookings";-->
<!--    $.ajax({-->
<!--      url: `${BASE_URL}/${bookingId}`,-->
<!--      method: "DELETE",-->
<!--      headers: {-->
<!--        "Authorization": `Bearer ${localStorage.getItem("token")}`-->
<!--      },-->
<!--      success: function (response) {-->
<!--        if (response.code === 200) {-->
<!--          alert("Booking cancelled successfully!");-->
<!--          checkUserLogin(); // Reload bookings-->
<!--        } else {-->
<!--          alert("Failed to cancel booking: " + response.message);-->
<!--        }-->
<!--      },-->
<!--      error: function (xhr) {-->
<!--        console.error("Error cancelling booking:", xhr);-->
<!--        alert("Failed to cancel booking: " + (xhr.responseJSON?.message || "Unknown error"));-->
<!--      }-->
<!--    });-->
<!--  }-->

<!--  // Initialize-->
<!--  $(document).ready(function () {-->
<!--    checkUserLogin();-->
<!--  });-->
<!--</script>-->
<!--</body>-->
<!--</html>-->

